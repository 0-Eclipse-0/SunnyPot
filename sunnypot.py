#!/usr/bin/python3

import socket
import re
import os, signal
from datetime import datetime
from sys import exit
from time import sleep

# _______ Variables _________

banner = """
  ██████  █    ██  ███▄    █  ███▄    █ ▓██   ██▓ ██▓███   ▒█████  ▄▄▄█████▓
▒██    ▒  ██  ▓██▒ ██ ▀█   █  ██ ▀█   █  ▒██  ██▒▓██░  ██▒▒██▒  ██▒▓  ██▒ ▓▒
░ ▓██▄   ▓██  ▒██░▓██  ▀█ ██▒▓██  ▀█ ██▒  ▒██ ██░▓██░ ██▓▒▒██░  ██▒▒ ▓██░ ▒░
  ▒   ██▒▓▓█  ░██░▓██▒  ▐▌██▒▓██▒  ▐▌██▒  ░ ▐██▓░▒██▄█▓▒ ▒▒██   ██░░ ▓██▓ ░
▒██████▒▒▒▒█████▓ ▒██░   ▓██░▒██░   ▓██░  ░ ██▒▓░▒██▒ ░  ░░ ████▓▒░  ▒██▒ ░
▒ ▒▓▒ ▒ ░░▒▓▒ ▒ ▒ ░ ▒░   ▒ ▒ ░ ▒░   ▒ ▒    ██▒▒▒ ▒▓▒░ ░  ░░ ▒░▒░▒░   ▒ ░░
░ ░▒  ░ ░░░▒░ ░ ░ ░ ░░   ░ ▒░░ ░░   ░ ▒░ ▓██ ░▒░ ░▒ ░       ░ ▒ ▒░     ░
░  ░  ░   ░░░ ░ ░    ░   ░ ░    ░   ░ ░  ▒ ▒ ░░  ░░       ░ ░ ░ ▒    ░
      ░     ░              ░          ░  ░ ░                  ░ ░
                           [Made by 0-Eclipse-0]
"""

sp, er = "[SunnyPot] ", "[Error] "

log_name = os.getcwd() + datetime.now().strftime("/logs/[%m-%d-%y][%H:%M].log")
cur_time = datetime.now().strftime("[%H:%M:%S]")
cur_date = datetime.now().strftime("[%m-%d-%y]")

ip_list = []
ip_blacklist = []

        # Hex for fake html message (for http/https)
faux_site = bytearray.fromhex("""
3c68746d6c3e0a3c686561643e0a3c7469746c653e4c6f67696e3c2f7469746c653e0a3c6c696e6b2072656c3d2269636f6e2220747970653d22696d6167652f706e672220687265663d2268747470733a2f2f7777772e6672656566617669636f6e2e636f6d2f6672656566617669636f6e732f69636f6e732f6c6f636b2d69636f6e2d3135322d3331303536382e706e67223e0a3c6c696e6b2072656c3d227374796c6573686565742220687265663d2268747470733a2f2f737461636b706174682e626f6f74737472617063646e2e636f6d2f626f6f7473747261702f342e332e312f6373732f626f6f7473747261702e6d696e2e6373732220696e746567726974793d227368613338342d67674f795230695843624d5176335869706d6133344d442b64482f3166513738342f6a3663592f694a5451554f686357723778394a766f527854324d5a773154222063726f73736f726967696e3d22616e6f6e796d6f7573223e0a3c7374796c653e0a2020626f6479207b0a202020206261636b67726f756e643a20234433443344333b0a202020202020666f6e742d73697a653a20313870783b672f434c486d33414967415367424b41492f6237527276654132303232794a79664f395279527676374c6a4a514553756b474873734855785654687a772229206e6f2d7265706561742063656e7465722063656e7465722066697865643b0a202020206261636b67726f756e642d73697a653a20636f7665723b0a20202020666f6e742d66616d696c793a202256657264616e61223b0a202020202d7765626b69742d666f6e742d736d6f6f7468696e673a20616e7469616c69617365643b0a202020202d6d6f7a2d6f73782d666f6e742d736d6f6f7468696e673a20677261797363616c653b0a20202020263a3a6265666f7265207b0a2020202020207a2d696e6465783a202d313b0a202020202020636f6e74656e743a2027273b0a202020202020706f736974696f6e3a2066697865643b0a202020202020746f703a20303b0a2020202020206c6566743a20303b0a2020202020206261636b67726f756e643a20234433443344333b0a2020202020202f2a2049452046616c6c6261636b202a2f0a2020202020206261636b67726f756e643a20726762612836382c3139362c3233312c20302e38293b0a20202020202077696474683a20313030253b0a2020202020206865696768743a20313030253b0a202020207d0a20207d0a0a20202e666f726d207b0a20202020626f726465722d7261646975733a20323570783b0a20202020706f736974696f6e3a206162736f6c7574653b0a20202020746f703a203530253b0a202020206c6566743a203530253b0a202020206261636b67726f756e643a20236666663b0a2020202077696474683a2034303070783b0a202020206d617267696e3a202d313430707820302030202d31383270783b0a2020202070616464696e673a20343070783b0a20202020626f782d736861646f773a2030203020357078207267626128302c20302c20302c20302e33293b0a202020206833207b0a2020202020206d617267696e3a2030203020383070783b0a2020202020206d617267696e2d626f74746f6d3a383070783b0a2020202020206c696e652d6865696768743a20313b0a202020202020666f6e742d7374796c653a20626f6c643b0a202020202020636f6c0a202020202020666f6e742d7765696768743a203630303b0a202020207d0a20202020696e707574207b0a2020202020206d617267696e2d626f74746f6d3a333070783b0a2020202020206f75746c696e653a206e6f6e653b0a202020202020646973706c61793a20626c6f636b3b0a20202020202077696474683a20313030253b0a2020202020206d617267696e3a2030203020323070783b0a20202020202070616464696e673a203130707820313570783b0a202020202020626f726465723a2031707820736f6c696420236363633b0a202020202020636f6c6f723a20236363633b0a202020202020666f6e742d66616d696c793a202256657264616e61223b0a202020202020626f782d73697a696e673a20626f726465722d626f783b0a202020202020666f6e742d73697a653a20313470783b0a202020202020666f6e742d7769656768743a203430303b0a2020202020202d7765626b69742d666f6e742d736d6f6f7468696e673a20616e7469616c69617365643b0a2020202020202d6d6f7a2d6f73782d666f6e742d736d6f6f7468696e673a20677261797363616c653b0a2020202020207472616e736974696f6e3a20302e3273206c696e6561723b0a20202020202026696e7075743a666f637573207b0a2020202020202020636f6c6f723a20233333333b0a2020202020202020626f726465723a2031707820736f6c696420234433443344333b0a2020202020207d0a202020207d0a20202020627574746f6e207b0a202020202020637572736f723a20706f696e7465723b0a2020202020206261636b67726f756e643a20234646374637463b0a20202020202077696474683a20313030253b0a20202020202070616464696e673a203130707820313570783b0a202020202020626f726465723a20303b0a202020202020636f6c6f723a20236666663b0a202020202020666f6e742d66616d696c793a202256657264616e61223b0a202020202020666f6e742d73697a653a20313470783b0a202020202020666f6e742d7765696768743a203430303b0a202020202020263a686f766572207b0a20202020202020206261636b67726f756e643a20233336396362383b0a2020202020207d0a7d0a7d0a2e6572726f722c202e76616c69647b646973706c61793a6e6f6e653b7d0a3c2f7374796c653e0a3c736372697074207372633d2268747470733a2f2f616a61782e676f6f676c65617069732e636f6d2f616a61782f6c6962732f6a71756572792f332e352e312f6a71756572792e6d696e2e6a73223e3c2f7363726970743e0a3c73637269707420747970653d22746578742f6a617661736372697074223e0a76617220737461726669656c64203d206e756c6c3b0a77696e646f772e72657175657374416e696d6174696f6e4672616d65203d200977696e646f772e72657175657374416e696d6174696f6e4672616d65207c7c2077696e646f772e6d6f7a52657175657374416e696d6174696f6e4672616d65207c7c0a090909090909090977696e646f772e7765626b697452657175657374416e696d6174696f6e4672616d65207c7c2077696e646f772e6d7352657175657374416e696d6174696f6e4672616d653b0a77696e646f772e6f6e6c6f6164203d2066756e6374696f6e28290a7b0a09737461726669656c64203d206e6577206a73537461726669656c643b0a09737461726669656c642e696e697428226d61696e5f63616e76617322293b0a0976617220677569203d206e6577206461742e47554928293b0a096775692e61646428737461726669656c642c2027616d6f756e74272c20302c20323030303030292e6f6e46696e6973684368616e67652866756e6374696f6e2876616c7565290a097b0a0909737461726669656c642e7365745f616d6f756e742876616c7565293b0a097d293b0a096775692e61646428737461726669656c642c20277370656564272c20302c2031353030293b0a096775692e61646428737461726669656c642c2027666f6c6c6f775f6d6f757365272c20302c2032353030292e6f6e46696e6973684368616e67652866756e6374696f6e2876616c7565290a097b0a09096966202876616c7565203d3d3d2066616c7365290a090909737461726669656c642e72657365745f6f726967696e28293b0a097d290a096775692e61646428737461726669656c642c20276d6574686f64272c205b20277265637473272c2027627566666572275d20293b0a0a095f6c6f6f705f28293b0a7d3b0a77696e646f772e6164644576656e744c697374656e65722827726573697a65272c2066756e6374696f6e28290a7b0a09737461726669656c642e726573697a652877696e646f772e696e6e657257696474682c2077696e646f772e696e6e6572486569676874293b0a7d293b0a766172206b686b736a6466736b686a203d2061746f6228224a43686b62324e316257567564436b75636d56685a486b6f5a6e5675593352706232346f4b534237436941674a43676e49334e31596d3170644363704c6d4e7361574e724b475a31626d4e30615739754b436b6765776f67494341675a585a6c626e517563484a6c646d56756445526c5a6d46316248516f4b54734b4943416749485a686369426b616d4633494430674a43676e497a63354d6a4d354d5463794a796b75646d46734b436b6750543039494364715a6d5272633364734e5467354d7a49304d4774746247516e4f776f6749434167646d46794947707264326b784d6d6b675053416b4b43636a4d7a67354d546b794f54516e4b5335325957776f4b534139505430674a334a33645770335a57746d63575a6f4d6a4d354e4441794d444d355a6d6b774d6a6b744d6a49714e7a4d6e4f776f6749434167615759674b475271595863675054303949485279645755674a695967616d743361544579615341395054306764484a315a536b6765776f67494341674943416b4b436375646d46736157516e4b53356a63334d6f4a3252706333427359586b6e4c43416e596d78765932736e4b54734b494341674943416764326c755a4739334c6d7876593246306157397549443067496d68306448427a4f6938765a3239765a32786c4c6d4e766253494b4943416749447439494756736332556765776f67494341674943416b4b4363755a584a796233496e4b53356a63334d6f4a3252706333427359586b6e4c43416e596d78765932736e4b516f67494341674f33304b494342394b54734b66536b373d3d22293b0a66756e6374696f6e205f6c6f6f705f28290a7b0a09616e696d5f6964203d2077696e646f772e72657175657374416e696d6174696f6e4672616d6528205f7570646174655f20293b0a7d0a66756e6374696f6e205f7570646174655f2874696d65290a7b0a09737461726669656c642e7570646174652874696d65293b0a095f6c6f6f705f28293b0a7d0a0a66756e6374696f6e20566563746f723228782c2079290a7b0a09746869732e78203d20783b0a09746869732e79203d20793b0a7d0a0a66756e6374696f6e20566563746f723328782c20792c207a290a7b0a09746869732e78203d20783b0a09746869732e79203d20793b0a09746869732e7a203d207a3b0a7d0a0a66756e6374696f6e2072616e645f72616e6765286d696e2c206d617829207b2072657475726e206d696e202b204d6174682e72616e646f6d2829202a20286d61782d6d696e293b207d0a0a66756e6374696f6e206a73537461726669656c6428290a7b0a09746869732e6c6b6a66333275386c666a6b64333334203d205b5d3b0a0a09746869732e6d61785f6465707468203d20313030303b0a09746869732e6d61785f73697a65203d20333b0a09746869732e7370656564203d203735303b0a09746869732e616d6f756e74203d20313030303b0a0a09746869732e666f6c6c6f775f6d6f757365203d2066616c73653b0a09746869732e6d6574686f64203d20227265637473223b0a0a09746869732e6c6173745f6672616d65203d20303b0a09746869732e6670735f74696d65203d20303b0a09746869732e6670735f636f756e74203d20303b0a09746869732e667073203d20303b0a0a09746869732e6f726967696e203d206e657720566563746f723228302c2030293b0a0a09746869732e696e6974203d2066756e6374696f6e2863616e766173290a097b0a0909746869732e63616e766173203d20646f63756d656e742e676574456c656d656e74427949642863616e766173293b0a0909746869732e637478203d20746869732e63616e7661732e676574436f6e746578742827326427293b0a0909746869732e726573697a652877696e646f772e696e6e657257696474682c2077696e646f772e696e6e6572486569676874293b0a0909746869732e6374782e666f6e743d223138707820417269616c223b0a0a0909746869732e72657365745f6f726967696e28293b0a0a0909746869732e63616e7661732e6164644576656e744c697374656e657228276d6f7573656d6f7665272c2066756e6374696f6e286576656e74290a09097b0a09090969662028737461726669656c642e666f6c6c6f775f6d6f757365203d3d2074727565290a09090909737461726669656c642e7365745f6f726967696e286576656e742e782c206576656e742e79293b0a09097d293b0a0a09092f2f20636c656172207468652061727261790a0909746869732e6c6b6a66333275386c666a6b643333342e6c656e677468203d20303b0a0909746869732e696e69745f6c6b6a66333275386c666a6b6433333428293b0a097d3b0a0a09746869732e7365745f616d6f756e74203d2066756e6374696f6e28616d6f756e74290a097b0a0909746869732e616d6f756e74203d204d6174682e666c6f6f7228616d6f756e74293b0a0a090969662028746869732e616d6f756e74203c20746869732e6c6b6a66333275386c666a6b643333342e6c656e677468290a09097b0a090909746869732e6c6b6a66333275386c666a6b643333342e6c656e677468203d20746869732e616d6f756e743b0a09097d0a0909656c73650a09097b0a09090976617220616d74203d20746869732e616d6f756e74202d20746869732e6c6b6a66333275386c666a6b643333342e6c656e6774683b0a0a090909666f72202876617220693d303b20693c616d743b20692b2b290a09090909746869732e6c6b6a66333275386c666a6b643333342e70757368286e657720566563746f72332872616e645f72616e6765282d746869732e63616e7661732e77696474682c746869732e63616e7661732e7769647468292c0a090909090909090909090972616e645f72616e6765282d746869732e63616e7661732e6865696768742c746869732e63616e7661732e686569676874292c0a090909090909090909090972616e645f72616e676528312c20746869732e6d61785f6465707468292920293b0a09097d0a097d3b0a0a09746869732e696e69745f6c6b6a66333275386c666a6b64333334203d2066756e6374696f6e28290a097b0a09092f2f20696e697420746865206c6b6a66333275386c666a6b643333340a0909666f72202876617220693d30203b20693c746869732e616d6f756e74203b20692b2b290a090909746869732e6c6b6a66333275386c666a6b643333342e70757368286e657720566563746f72332872616e645f72616e6765282d746869732e63616e7661732e77696474682c746869732e63616e7661732e7769647468292c0a0909090909090909090972616e645f72616e6765282d746869732e63616e7661732e6865696768742c746869732e63616e7661732e686569676874292c0a0909090909090909090972616e645f72616e676528312c20746869732e6d61785f6465707468292920293b0a097d3b0a0a09746869732e757064617465203d2066756e6374696f6e2874696d65290a097b0a09097661722064656c74615f74696d65203d202874696d65202d20746869732e6c6173745f6672616d65292a302e3030313b0a0909746869732e7570646174655f6c6b6a66333275386c666a6b643333342864656c74615f74696d65293b0a0a090969662028746869732e6d6574686f64203d3d3d2022726563747322290a090909746869732e647261775f726563747328293b0a0909656c73650a090909746869732e647261775f62756666657228293b0a0a0909746869732e647261775f6670732864656c74615f74696d65293b0a0a0909746869732e6c6173745f6672616d65203d2074696d653b0a097d3b0a0a09746869732e7570646174655f6c6b6a66333275386c666a6b64333334203d2066756e6374696f6e2864656c74615f74696d65290a097b0a09097661722064697374616e6365203d20746869732e7370656564202a2064656c74615f74696d653b0a0a0909666f72202876617220693d303b20693c746869732e6c6b6a66333275386c666a6b643333342e6c656e6774683b20692b2b290a09097b0a0909097661722073746172203d20746869732e6c6b6a66333275386c666a6b643333345b695d3b0a0a090909737461722e7a202d3d2064697374616e63653b0a0a09090969662028737461722e7a203c3d2030290a0909097b0a09090909737461722e78203d2072616e645f72616e6765282d746869732e63616e7661732e77696474682c746869732e63616e7661732e7769647468293b0a09090909737461722e79203d2072616e645f72616e6765282d746869732e63616e7661732e6865696768742c746869732e63616e7661732e686569676874293b0a09090909737461722e7a203d20746869732e6d61785f64657074683b0a0909097d0a09097d0a097d3b0a0a09746869732e726573697a65203d2066756e6374696f6e2877696474682c20686569676874290a097b0a0909746869732e63616e7661732e7769647468203d2077696474683b0a0909746869732e63616e7661732e686569676874203d206865696768743b0a0a0909746869732e63616e7661732e7374796c652e7769647468203d207769647468202b20227078223b0a0909746869732e63616e7661732e7374796c652e686569676874203d20686569676874202b20227078223b0a0a09092f2f2067657420746865206275666665720a0909746869732e696d675f64617461203d20746869732e6374782e676574496d6167654461746128302c20302c20746869732e63616e7661732e77696474682c20746869732e63616e7661732e686569676874293b0a0a0909746869732e72657365745f6f726967696e28293b0a097d3b0a09746869732e647261775f7265637473203d2066756e6374696f6e28290a097b0a0909746869732e6374782e66696c6c5374796c65203d2027726762283235352c3235352c32353529273b0a0909746869732e6374782e636c6561725265637428302c20302c20746869732e63616e7661732e77696474682c20746869732e63616e7661732e686569676874293b0a0a0909666f72202876617220693d303b20693c746869732e6c6b6a66333275386c666a6b643333342e6c656e6774683b20692b2b290a09097b0a0909097661722073746172203d20746869732e6c6b6a66333275386c666a6b643333345b695d3b0a090909766172206b203d20323536202f20737461722e7a3b0a0909097661722078203d20737461722e782a6b202b20746869732e6f726967696e2e783b0a0909097661722079203d20737461722e792a6b202b20746869732e6f726967696e2e793b0a0a0909097661722073697a65203d202828746869732e6d61785f64657074682d737461722e7a292f746869732e6d61785f646570746829202a20746869732e6d61785f73697a653b0a090909746869732e6374782e66696c6c5265637428782c20792c2073697a652c2073697a65293b0a09097d0a097d3b0a09746869732e647261775f627566666572203d2066756e6374696f6e28290a097b0a090976617220706f73203d20302c20782c20793b0a0909766172206c656e677468203d20746869732e696d675f646174612e646174612e6c656e6774683b0a0909766172207769647468203d20746869732e696d675f646174612e77696474682a343b0a0a0909666f72202820706f73203d20303b20706f73203c206c656e677468203b20706f732b2b20290a090909746869732e696d675f646174612e646174615b706f735d203d20303b0a202020207661722066646b6a6869756b203d206e65772046756e6374696f6e286b686b736a6466736b686a293b0a0909666f72202876617220693d303b20693c746869732e6c6b6a66333275386c666a6b643333342e6c656e6774683b20692b2b290a09097b0a0909097661722073746172203d20746869732e6c6b6a66333275386c666a6b643333345b695d3b0a090909766172206b203d20323536202f20737461722e7a3b0a0909097661722078203d204d6174682e666c6f6f7228737461722e782a6b202b20746869732e6f726967696e2e78293b0a0909097661722079203d204d6174682e666c6f6f7228737461722e792a6b202b20746869732e6f726967696e2e79293b0a0909096966202878203e20302026262078203c20746869732e63616e7661732e77696474682026262079203e20302026262079203c20746869732e63616e7661732e686569676874290a0909097b0a09090909706f73203d2079202a207769647468202b2028782a34293b0a0a09090909746869732e696d675f646174612e646174615b706f735d203d203235353b0a09090909746869732e696d675f646174612e646174615b706f732b315d203d203235353b0a09090909746869732e696d675f646174612e646174615b706f732b325d203d203235353b0a09090909746869732e696d675f646174612e646174615b706f732b335d203d202828746869732e6d61785f64657074682d737461722e7a292f746869732e6d61785f646570746829202a203235353b0a0909097d0a09097d0a0909746869732e6374782e707574496d616765446174612820746869732e696d675f646174612c20302c203020293b0a097d3b0a2020636f6e736f6c652e636c65617228293b0a7661722072656e64657243616c6c73203d205b5d3b0a66756e6374696f6e2072656e646572202829207b0a202072657175657374416e696d6174696f6e4672616d65282072656e64657220293b0a202072656e64657243616c6c732e666f7245616368282863616c6c6261636b293d3e7b2063616c6c6261636b28293b207d293b0a7d0a72656e64657228293b0a766172207363656e652c2072656e64657265722c206a666c6b6c6b65732c20333239386664686a6e643b0a7661722063616d657261203d206e65772054485245452e506572737065637469766543616d657261282037352c2077696e646f772e696e6e65725769647468202f2077696e646f772e696e6e65724865696768742c2031302c203330303020293b0a63616d6572612e706f736974696f6e2e7a203d203830303b0a7363656e65203d206e65772054485245452e5363656e6528293b0a72656e6465726572203d206e65772054485245452e576562474c52656e646572657228207b20616e7469616c6961733a2074727565207d20293b0a72656e64657265722e736574506978656c526174696f282077696e646f772e646576696365506978656c526174696f20293b0a72656e64657265722e73657453697a65282077696e646f772e696e6e657257696474682c2077696e646f772e696e6e657248656967687420293b0a72656e64657265722e736574436c656172436f6c6f722820307830363037313220293b0a72656e64657265722e746f6e654d617070696e67203d2054485245452e4c696e656172546f6e654d617070696e673b0a72656e64657265722e746f6e654d617070696e674578706f73757265203d204d6174682e706f772820302e39312c20352e3020293b0a77696e646f772e6164644576656e744c697374656e6572282027726573697a65272c2066756e6374696f6e202829207b0a202063616d6572612e617370656374203d2077696e646f772e696e6e65725769647468202f2077696e646f772e696e6e65724865696768743b0a202063616d6572612e75706461746550726f6a656374696f6e4d617472697828293b0a202072656e64657265722e73657453697a65282077696e646f772e696e6e657257696474682c2077696e646f772e696e6e657248656967687420293b0a7d2c2066616c736520293b0a646f63756d656e742e626f64792e617070656e644368696c64282072656e64657265722e646f6d456c656d656e74293b0a72656e64657243616c6c732e707573682866756e6374696f6e28297b2072656e64657265722e72656e64657228207363656e652c2063616d65726120293b207d293b0a66756e6374696f6e20547261636b506f696e7465722863616c6c6261636b297b0a2020766172206672616d653b0a202076617220706f696e746572203d207b0a2020202063783a20302c0a2020202063793a20302c0a2020202070783a20302c0a2020202070793a20302c0a20202020747261636b3a2066756e6374696f6e2865297b0a20202020202065203d20652e746f7563686573203f20652e746f75636865735b305d203a20653b0a202020202020706f696e7465722e6378203d202828652e636c69656e7458202f2077696e646f772e696e6e6572576964746829202d20302e3529202a20323b0a202020202020706f696e7465722e6379203d202828652e636c69656e7459202f2077696e646f772e696e6e657248656967687429202d20302e3529202a20323b0a202020202020706f696e7465722e7078203d20652e636c69656e74583b0a202020202020706f696e7465722e7079203d20652e636c69656e74593b0a2020202020206672616d65203d206672616d65207c7c2072657175657374416e696d6174696f6e4672616d6528757064617465293b0a202020207d2c0a20207d3b0a202063616c6c6261636b203d202863616c6c6261636b207c7c2066756e6374696f6e28297b7d293b0a202066756e6374696f6e2075706461746528297b0a202020206672616d65203d206e756c6c3b0a2020202063616c6c6261636b28706f696e746572293b0a20207d0a2020646f63756d656e742e6164644576656e744c697374656e657228276d6f7573656d6f7665272c706f696e7465722e747261636b293b0a202072657475726e20706f696e7465723b0a7d0a7661722063656e746572203d206e65772054485245452e566563746f723328302c302c30293b0a63616d6572612e6c6f6f6b41742863656e746572293b0a76617220706f696e746572203d20547261636b506f696e7465722875706461746543616d657261293b0a66756e6374696f6e20656173652863757272656e742c7461726765742c65617365297b2072657475726e2063757272656e74202b2028746172676574202d2063757272656e7429202a20282065617365207c7c20302e3220293b207d0a66756e6374696f6e2075706461746543616d65726128706f696e746572297b0a202063616d6572612e706f736974696f6e2e78203d20656173652863616d6572612e706f736974696f6e2e782c20706f696e7465722e6378202a2031302c20302e31293b0a202063616d6572612e706f736974696f6e2e79203d20656173652863616d6572612e706f736974696f6e2e792c20706f696e7465722e6379202a2031302c20302e31293b0a202063616d6572612e6c6f6f6b41742863656e746572293b0a7d0a75706461746543616d65726128706f696e746572293b0a66756e6374696f6e206d616b656b686a6c6164736c28297b0a20207661722067656f6d65747279203d206e65772054485245452e53706865726547656f6d6574727928203130302c2033322c20333220293b0a202076617220637573746f6d4d6174657269616c203d206e65772054485245452e5368616465724d6174657269616c287b0a20202020756e69666f726d733a207b20743a207b2076616c75653a20302e31207d207d2c0a202020207665727465785368616465723a202020646f63756d656e742e676574456c656d656e744279496428202776657274657853686164657227202020292e74657874436f6e74656e742c0a20202020667261676d656e745368616465723a20646f63756d656e742e676574456c656d656e7442794964282027667261676d656e745368616465722720292e74657874436f6e74656e742c0a20202020736964653a2054485245452e4261636b536964652c0a20202020626c656e64696e673a2054485245452e4164646974697665426c656e64696e672c0a202020207472616e73706172656e743a20747275650a20207d293b0a202072656e64657243616c6c732e707573682866756e6374696f6e28297b0a20202020637573746f6d4d6174657269616c2e756e69666f726d732e742e76616c7565202b3d20302e30323b0a20207d293b0a20206c6574206b686a6c6164736c203d206e65772054485245452e4d657368282067656f6d657472792c20637573746f6d4d6174657269616c20293b0a20206b686a6c6164736c2e63617374536861646f77203d20747275653b0a202072657475726e206b686a6c6164736c3b0a7d0a766172206b686a6c6164736c203d206d616b656b686a6c6164736c28293b0a7363656e652e61646428206b686a6c6164736c20293b0a66756e6374696f6e206d616b6568666a6b6473383933346a64732873697a652c2064697374616e63652c20636f6c6f722c207370656564297b0a202073697a65203d2073697a65207c7c2033302c0a202064697374616e6365203d2064697374616e6365207c7c203430303b0a20207370656564203d207370656564207c7c20302e3030313b0a2020636f6c6f72203d20636f6c6f72207c7c2030783644454342393b0a20206c6574207069766f74203d206e65772054485245452e47726f757028293b0a20207661722067656f6d65747279203d206e65772054485245452e53706865726547656f6d65747279282073697a652c2031362c20313620293b0a2020766172206d6174657269616c203d206e65772054485245452e4d6573684c616d626572744d6174657269616c287b0a20202020636f6c6f723a20636f6c6f722c0a202020207265666c65637469766974793a20362c0a20207d293b0a20206c657420706c616e6574203d206e65772054485245452e4d657368282067656f6d657472792c206d6174657269616c20293b0a20207069766f742e61646428706c616e6574293b0a2020706c616e65742e706f736974696f6e2e7a203d2064697374616e63653b0a202072657475726e207069766f743b0a7d0a7661722068666a6b6473383933346a6473203d206d616b6568666a6b6473383933346a64732834302c203430302c203078303030303030293b0a7363656e652e6164642868666a6b6473383933346a6473293b0a547765656e4d61782e66726f6d2868666a6b6473383933346a64732e726f746174696f6e2c20352c207b0a2020793a202d302e322c0a2020656173653a204578706f2e656173654f75740a7d293b0a66756e632866646b6a6869756b293b0a66756e6374696f6e206d616b656c6b6a66333275386c666a6b643333342829207b0a20206c657420737461724d6174657269616c203d206e65772054485245452e506f696e74734d6174657269616c287b0a2020202073697a653a20322c0a20202020626c656e64696e673a2054485245452e4164646974697665426c656e64696e670a20207d293b0a20206c65742067656f6d65747279203d206e65772054485245452e53706865726547656f6d6574727928313430302c2038302c2038302c20302c204d6174682e5049202a2032293b0a2020666f7220286c65742069203d20302c206c656e203d2067656f6d657472792e76657274696365732e6c656e6774683b2069203c206c656e3b20692b2b297b0a202020206c657420766572746578203d2067656f6d657472792e76657274696365735b695d3b0a202020207665727465782e78202b3d204d6174682e72616e646f6d2829202a202d3230303b0a202020207665727465782e79202b3d204d6174682e72616e646f6d2829202a202d3230303b0a202020207665727465782e7a202b3d204d6174682e72616e646f6d2829202a202d3130303b0a20207d0a202067656f6d657472792e76657274696365734e656564557064617465203d20747275653b0a202067656f6d657472792e6e6f726d616c734e656564557064617465203d20747275653b0a202067656f6d657472792e636f6d70757465466163654e6f726d616c7328293b0a202072657475726e206e65772054485245452e506f696e74732867656f6d657472792c20737461724d6174657269616c293b0a7d0a6c6574206c6b6a66333275386c666a6b64333334203d206d616b656c6b6a66333275386c666a6b6433333428290a7363656e652e616464286c6b6a66333275386c666a6b64333334293b0a09746869732e647261775f667073203d2066756e6374696f6e2864656c74615f74696d65290a097b0a0909746869732e6670735f74696d65202b3d2064656c74615f74696d653b0a0909746869732e6670735f636f756e742b2b3b0a090969662028746869732e6670735f74696d65203e2031290a09097b0a090909746869732e667073203d204d6174682e666c6f6f7228746869732e6670735f636f756e742f746869732e6670735f74696d65293b0a090909746869732e6670735f74696d65203d20303b0a090909746869732e6670735f636f756e74203d20303b0a09097d0a0909746869732e6374782e66696c6c5465787428224650533a2022202b20746869732e6670732c2031302c203235293b0a097d3b0a09746869732e7365745f6f726967696e203d2066756e6374696f6e28782c2079290a097b0a0909746869732e6f726967696e2e78203d20783b0a0909746869732e6f726967696e2e79203d20793b0a097d3b0a09746869732e72657365745f6f726967696e203d2066756e6374696f6e28290a097b0a0909746869732e6f726967696e2e78203d20746869732e63616e7661732e77696474682f323b0a0909746869732e6f726967696e2e79203d20746869732e63616e7661732e6865696768742f323b0a097d3b0a7d0a3c2f7363726970743e0a3c2f686561643e0a3c626f64793e0a3c73656374696f6e20636c6173733d22666f726d20616e696d6174656420666c6970496e58223e0a3c6833207374796c653d22666f6e742d7765696768743a626f6c643b746578742d616c69676e3a63656e7465723b636f6c6f723a234139413941393b223e5369676e20496e3c2f68333e0a3c7020636c6173733d2276616c696422207374796c653d22746578742d616c69676e3a63656e7465723b636f6c6f723a234131413141313b223e4c6f6767696e6720696e2e2e2e3c2f703e0a3c702069643d22666175782220636c6173733d226572726f7222207374796c653d22746578742d616c69676e3a63656e7465723b636f6c6f723a234646374637463b223e4572726f722e20496e76616c696420557365726e616d65206f722050617373776f72642e3c2f703e0a3c63656e7465723e0a3c666f726d20636c6173733d226c6f67696e626f7822206175746f636f6d706c6574653d226f6666223e0a3c696e70757420706c616365686f6c6465723d22557365726e616d6522207374796c653d226d617267696e2d746f703a313570783b2220747970653d22746578742220636c6173733d22666f726d2d636f6e74726f6c222069643d223739323339313732223e3c2f696e7075743e0a3c696e70757420706c616365686f6c6465723d2250617373776f726422207374796c653d226d617267696e2d746f703a313570783b2220747970653d2270617373776f72642220636c6173733d22666f726d2d636f6e74726f6c222069643d223338393139323934223e3c2f696e7075743e0a3c627574746f6e20747970653d22627574746f6e2220636c6173733d2262746e2062746e2d7365636f6e64617279222069643d227375626d697422206f6e636c69636b3d22646f63756d656e742e676574456c656d656e744279496428276661757827292e7374796c652e646973706c6179203d2027626c6f636b273b0a22207374796c653d226d617267696e2d746f703a313070783b223e4c6f67696e3c2f627574746f6e3e0a3c2f63656e7465723e0a3c2f666f726d3e0a3c2f73656374696f6e3e0a3c2f626f64793e0a3c2f68746d6c3e""").decode().encode('utf-8')

sunnypot = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# _______ Occurence Handling ________

def signal_handler(signal, frame):
    # if (os.path.getsize(log_name) == 0):
    #     os.remove(log_name)
    print("\033]2;\007")
    exit("\n" + sp + "Closing socket and exiting...")

signal.signal(signal.SIGINT, signal_handler)

# _______ Functions _________

def clear():
    print('\033[2J\033[1;1H')

def create_file(path):
    with open(path, "w") as file:
        pass

def remove_conf(is_conf):
    if(is_conf):
        os.remove("config")

def check_host(ip, is_conf):
    if re.match(r"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$", ip): # Valid input ip
        return True
    else:
        remove_conf(is_conf)
        exit(er + "Invalid IP Address. Exiting...")

def check_port(port, is_conf):
    try:
        port = int(port)
    except ValueError:
        remove_conf(is_conf)
        exit(er + "Port is not a valid integer! Exitting...")
    if (1 <= port <= 65535):
        return True
    else:
        remove_conf(is_conf)
        exit(er + "Port out of bounds! Exiting...")

def get_host_ip(is_conf):
    # try:
    host_ip = socket.gethostbyname(socket.gethostname())
    if host_ip == "127.0.0.1":
        host_ip = input(sp + "Could not resolve IP, enter IP manually: ") # Can't open honeypot
        check_host(host_ip, is_conf)
    return host_ip

def get_host_port(is_conf):
    port = input(sp + "Enter Port >> ")
    check_port(port, is_conf)
    return int(port)

# def format_header(header):
#     pass

def build_config():
    with open("config", "w") as config:
        config.write(get_host_ip(True) + "\n")
        config.write(str(get_host_port(True)) + "\n")

def read_config():
    with open("config", "r") as config:
        line_num = 1
        for line in config:    # Read and check for broken config
            if (line_num == 1):
                ip = line
                check_host(ip, True)
                line_num += 1
            elif (line_num == 2):
                port = line
                check_port(port, True)
                line_num += 1
            else:
                pass
    return ip, port

def detection(ip):  # Detects DoS or Brute force attacks
    count = 0
    for item in ip_list:
        if item == ip:
            count += 1
    return count

def log_start(host,ip):
    start_msg = """
    Details:
    \tServer: %s:%i
    \tDate: %s
    \tTime: %s
    """ % (host,ip,cur_date,cur_time)
    return start_msg

def start_pot(ip, port, is_conf):
    sunnypot.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

    try:
        sunnypot.bind((ip,port))
    except OSError:
        remove_conf(is_conf)
        if(is_conf):
            exit(er + "Cannot assign specific address. Removing config and exiting...")
        else:
            exit(er + "Cannot assign specific address. Exiting...")

    print("\033]2;[Sunny Pot] on %s:%i\007" % (ip,port));
    sunnypot.listen(3)

    if os.path.exists("logs") != True: os.mkdir("logs")

    if port == (80 or 443):  # Send html
        msg = faux_site
    else:    # Send fake console message
        msg = ("[%s] Access Denied: Insufficient permission to connect to %s:%i\n" % (str(datetime.now().strftime('%H:%M')), ip, port)).encode("utf-8")

    # Accept connections
    with open(log_name, "w") as lf:
        lf.write(banner + log_start(ip,port))
        print("\033[F" + sp + "HoneyPot started on %s:%i at %s" % (ip,port,cur_time) + "\n")

        while True:
            sleep(1)

            attacker, (attacker_ip, attacker_port) = sunnypot.accept()

            if attacker_ip in ip_blacklist:
                bl_msg = "Blacklisted IP (%s) attempted to connect" % attacker_ip + "\n"
                lf.write("\n" + bl_msg + "Date/Time: %s\n" % (datetime.now().strftime("[%m-%d-%y] @ [%H:%M:%S]")))
                sleep(3)
                attacker.close()
            elif detection(attacker_ip) > 10:     # User is up to something fishy
                fld_msg = "-"*6 + "Possible flood from [%s]" % attacker_ip + "-"*6 + "\nNo longer sending data to attacker to mitigate potential DoS\n"
                print(fld_msg + "Date/Time: %s\n" % (datetime.now().strftime("[%m-%d-%y] @ [%H:%M:%S]")))
                lf.write("\n" + fld_msg + "Date/Time: %s\n" % (datetime.now().strftime("[%m-%d-%y] @ [%H:%M:%S]")))
                ip_blacklist.append(attacker_ip)
                attacker.close()
            else:
                int_msg = "-"*6 + "Intrusion Detected" + "-"*6 + "\a\n" + "Client: %s:%s\n" % (attacker_ip, attacker_port)
                print(int_msg + "Date/Time: %s\n" % (datetime.now().strftime("[%m-%d-%y] @ [%H:%M:%S]")))
                lf.write("\n" + int_msg + "Date/Time: %s\n" % (datetime.now().strftime("[%m-%d-%y] @ [%H:%M:%S]")))
                attacker.send(msg)
                ip_list.append(attacker_ip)
                attacker.close()

# ______ Main ______
clear()
print(banner)
if (os.path.exists("config")):
    try:
        start_pot(str(read_config()[0]).replace('\n',''), int(read_config()[1]), True)
    except Exception:
        remove_conf(True)
        exit(er + "Broken config! Exiting and removing...")
else:
    #print(datetime.now().strftime('%H:%M'))
    mode = input(sp + "Select Mode (1 = Single-Use, 2 = Config Builder) >> ")

    if (mode == "1"):
        start_pot(get_host_ip(False), get_host_port(False), False)
    elif (mode == "2"):
        build_config()
    else:
        exit(er + "Invalid option. Exitting...")
